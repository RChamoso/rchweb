
var fbObject={config:function(yourConfig){if(typeof(fbObject._defaultLoaded)==='undefined'){fbObject._facebookButton={onClick:'fbObject._events.loginUser',imgSrc:'//'+SM.hostConfig.cdnHost+'/img/facebook_auth_login_button.png',logoutImgSrc:'//'+SM.hostConfig.cdnHost+'/img/facebook_auth_logout_button.png',renderImmediately:false,styleProperty:'display',facebookButtonID:'facebookButtonID',elementId:'facebookButton',renderLogoutButton:false,loginButtonCSS:'',logoutButtonCSS:''};fbObject._settings={requiredPermissions:'offline_access,user_photos,user_videos,friends_videos,friends_photos,user_photo_video_tags',scriptLocation:'//connect.facebook.net/en_US/all.js',timeOutValue:4000,debug:false,smAutoLogin:true,serviceID:1,loginServiceType:2,registrationServiceType:1,useButton:true,useWelcomeMessage:true,quickFetchUserData:false,defaultObject:'me',quickLoginEnabled:true,disableLibrary:false,version:'1.2'};fbObject._welcomeMessage={renderImmediately:false,styleProperty:'display',elementId:'welcomeMessageID'};fbObject._loginForm={elementId:'fbLoginElements'};fbObject._registrationForm={elementId:'fbRegistrationElements'};fbObject._apiData={apiKey:SM.APIKey['fbAppId']};fbObject._events={logout:fbObject.logout,allDone:fbObject.allDone,loginUser:fbObject.loginUser,checkPermissions:fbObject.checkPermissions,getAlbums:fbObject.getAlbums,initiateLogin:fbObject.initiateLogin,almostDone:fbObject.almostDone,authedUser:fbObject.authedUser,logoutUser:fbObject.logoutUser,logout:fbObject.logout,smAccountStatus:fbObject.smAccountStatus,renderForm:fbObject.renderForm,populateForm:fbObject.populateForm,renderButton:fbObject.renderButton,renderWelcomeMessage:fbObject.renderWelcomeMessage,eventsComplete:{},smLogin:fbObject.smLogin,quickSessionCheck:{},noSession:{},permissionDenied:{},noSession:fbObject.noSession};fbObject._messages={cantCreateObject:'We ran into some problems creating the facebook object',cantGetScript:'Unable to connect with Facebook at this time. Please try again later.',scriptTimedOut:'Unable to connect with Facebook at this time (request timed out). Please try again later.',cantGetAlbums:'Facebook is having some problems, and was unable to return your albums.',welcomeMessage:'<img src="{accountPhoto}" style="float:left;padding:4px;"> Welcome, {accountName}. You are signed in with your Facebook account. [<a href="#" onclick="{logoutLink}">Logout</a>]'};fbObject.initDictionary();fbObject._state={buttonRendered:false,buttonHidden:false,fbResponse:false,userData:false,welcomeMessageRendered:false,safeFBUserData:false,canLogin:false,canLink:false,changedPermissions:true,hasPermissions:false,loggedOut:false,loginURL:false,activeSession:false,hasAccount:false,loginButton:false,logoutButton:false,welcomeMessage:false,user:false,albums:[],pages:[],permissions:[]};fbObject._defaultLoaded=true;}
for(var p in yourConfig){switch(p){case'facebookButton':fbObject._facebookButton=YAHOO.lang.merge(fbObject._facebookButton,yourConfig[p]);break;case'settings':fbObject._settings=YAHOO.lang.merge(fbObject._settings,yourConfig[p]);break;case'events':fbObject._events=YAHOO.lang.merge(fbObject._events,yourConfig[p]);break;case'welcomeMessage':fbObject._welcomeMessage=YAHOO.lang.merge(fbObject._welcomeMessage,yourConfig[p]);break;default:}}
if(fbObject._settings.debug){fbObject._settings=fbObject._mergeRecursive(fbObject._settings,{scriptLocation:'static.ak.fbcdn.net/connect/en_US/core.debug.js'});}},initDictionary:function(){fbObject._cache={smAccountStatus:false};fbObject.dictionary={};fbObject.dictionary.albums={};fbObject.dictionary.pages={};fbObject.dictionary.authenticatedUser={userId:false,accessToken:false,savedAccount:false,validAccount:false};fbObject.dictionary.permissions={};fbObject.dictionary.user={accessToken:false,expiresIn:false,signedRequest:false,userID:false,status:false};fbObject.dictionary.smAccount={hasAccount:false,canLink:false,canLogin:false};},init:function(){if(fbObject._settings==undefined){fbObject.config();}
if(fbObject._settings.disableLibrary){return false;}
YE.onDOMReady(function(){if(!fbObject._elementExists('fb-root')){fbDiv=document.createElement("div");fbDiv.id="fb-root";document.body.appendChild(fbDiv);}});YAHOO.util.Get.script(fbObject._settings.scriptLocation,{onSuccess:function(){window.fbAsyncInit=function(){try{if(typeof FB!=='undefined'){FB.init({appId:fbObject._apiData.apiKey,status:true,cookie:true,xfbml:true,channelURL:'//'+SM.hostConfig.mainHost+'/channel.html',oauth:true});FB.getLoginStatus(function(response){if(fbObject.dictionary.authenticatedUser.accessToken&&fbObject.dictionary.authenticatedUser.userId){fbObject.getUserData(function(){fbObject.getPermissions(function(permsResponse){if(permsResponse){return true;}else{if(typeof(fbObject._events.authedUser)==='function')fbObject._events.authedUser(fbObject.dictionary,clickEvent);}});});}
if(response.authResponse){fbObject.doOnAuth(response);}else{if(typeof(fbObject._events.noSession)==='function')fbObject._events.noSession();}});FB.Event.subscribe('auth.authResponseChange',function(response){if(response.status!='connected'&&!fbObject._state.loggedOut){fbObject._events.logoutUser();}});FB.Event.subscribe('auth.logout',function(response){fbObject._events.logout();});}else{alert(fbObject._messages.cantCreateObject);}}
catch(err){alert(err);}};},onFailure:function(){},onTimeout:function(){},timeout:fbObject._settings.timeOutValue});},logout:function(response){},authenticateUser:function(userId,accessToken){if(!fbObject.isUndefined(userId)){fbObject.dictionary.authenticatedUser.userId=userId;}
if(!fbObject.isUndefined(accessToken)){fbObject.dictionary.authenticatedUser.accessToken=accessToken;}
return true;},logoutUser:function(){FB.logout(function(response){fbObject._state.activeSession=false;fbObject._state.loggedOut=true;fbObject._state.fbResponse=false;fbObject.initDictionary();if(typeof(fbObject._events.logout)==='function'){fbObject._events.logout(response);}});},shareLink:function(linkUrl,linkTitle,linkDescription,linkPicture){FB.ui({method:'send',fbname:linkTitle,description:linkDescription,picture:linkPicture,link:linkUrl});},doOnAuth:function(response,clickEvent){clickEvent=(typeof clickEvent==='undefined')?false:clickEvent;fbObject.dictionary.user={accessToken:response.authResponse.accessToken,expiresIn:response.authResponse.expiresIn,signedRequest:response.authResponse.signedRequest,userID:response.authResponse.userID,status:response.status};fbObject._state.fbResponse=response;fbObject._state.activeSession=true;if(typeof(fbObject._events.quickSessionCheck)==='function')fbObject._events.quickSessionCheck();fbObject.getPermissions(function(permsResponse){if(permsResponse){if(typeof(fbObject._events.allDone)==='function')fbObject._events.allDone(fbObject.dictionary,clickEvent);}else{if(typeof(fbObject._events.almostDone)==='function')fbObject._events.almostDone(fbObject.dictionary,clickEvent);}});},almostDone:function(response){},authedUser:function(response){},initiateLogin:function(permissionsNeeded){permissionsNeeded=(typeof permissionsNeeded==='undefined')?fbObject._settings.requiredPermissions:permissionsNeeded;FB.getLoginStatus(function(response){if(response.authResponse){fbObject.doOnAuth(response);}else{fbObject._events.loginUser();}});},allDone:function(response,clickEvent){if(fbObject._settings.quickFetchUserData)fbObject.getUserData();},loginUser:function(permissionsNeeded,clickEvent){permissionsNeeded=(typeof permissionsNeeded==='undefined')?fbObject._settings.requiredPermissions:permissionsNeeded;FB.login(function(response){if(response.authResponse){fbObject.doOnAuth(response,clickEvent);}else{}},{scope:permissionsNeeded});},composeWelcomeMessage:function(welcomeTemplate){welcomeTemplate=(typeof welcomeTemplate==='undefined')?fbObject._messages.welcomeMessage:welcomeTemplate;welcomeTemplate.replace("","");},getPermissions:function(returnValueFunc,permissionsNeeded){permissionsNeeded=(fbObject.isUndefined(permissionsNeeded))?fbObject._settings.requiredPermissions:permissionsNeeded;FB.api({method:'fql.query',query:'SELECT '+permissionsNeeded+' FROM permissions WHERE uid='+fbObject.dictionary.user.userID},function(queryResponse){for(var prop in queryResponse[0]){var bolValue=(queryResponse[0][prop]==0)?false:true;fbObject.dictionary.permissions[prop]=bolValue;if(bolValue){var yesPermission=true;}else{var noPermission=true;}}
if(typeof noPermission==='undefined'&&typeof yesPermission==='boolean'){var hasPermissions=true;}else{var hasPermissions=false;}
fbObject.dictionary.user.hasPermissions=hasPermissions;if(typeof(returnValueFunc)==='function')returnValueFunc(hasPermissions);});},checkPermissions:function(permissionsList,returnValueFunc){permissionsList=(fbObject.isUndefined(permissionsList))?fbObject._settings.requiredPermissions:permissionsList;var permissions=permissionsList.split(',');for(var i=0;i<permissions.length;i++){if(fbObject.dictionary.permissions[permissions[i]]==true){var yesPermission=true;}else{var noPermission=true;}}
if(typeof noPermission==='undefined'&&typeof yesPermission==='boolean'){var hasPermissions=true;}else{var hasPermissions=false;}
if(typeof(returnValueFunc)==='function')returnValueFunc(hasPermissions);return hasPermissions;},getAlbums:function(returnValueFunc,objectId){objectId=(typeof objectId=='undefined')?fbObject._settings.defaultObject:objectId;if(typeof FB!=='undefined'){FB.api('/'+objectId+'/albums?limit=100',function(response){if(typeof(response)==='object'){fbObject.dictionary.albums[objectId]={};FB.Array.forEach(response.data,function(album){if(typeof(album)==='object'){var photoCount=(typeof album.count==='undefined')?0:album.count;fbObject.dictionary.albums[objectId][album.id]={id:album.id,name:album.name,count:photoCount};}else{}});}else{}
if(typeof(returnValueFunc)==='function')returnValueFunc(fbObject.dictionary.albums[objectId]);});}else{}},getPages:function(returnValueFunc){if(typeof FB!=='undefined'){var objectLocation='me';var accessToken='';if(fbObject.dictionary.authenticatedUser.userId&&fbObject.dictionary.authenticatedUser.accessToken){objectLocation=fbObject.dictionary.authenticatedUser.userId;accessToken=fbObject.dictionary.authenticatedUser.accessToken;}
try{FB.api('/'+objectLocation+'/accounts?limit=100',{'access_token':accessToken},function(response){if(response.error){YD.get(noPermissionId).style.display='';return false;}else{if(response.data.length==0){return false;}}
for(row in response.data){if(response.data[row].category!='Application'){fbObject.dictionary.pages[response.data[row].id]={id:response.data[row].id,name:response.data[row].name,accessToken:response.data[row].access_token}}}
if(typeof(returnValueFunc)==='function')returnValueFunc(fbObject.dictionary.pages);});}
catch(err){alert('I\'m sorry, there was an error: . '+err);}}else{alert(fbObject._messages.cantCreateObject);}},getUserData:function(trueValueFunc,useCookies){if(typeof FB!=='undefined'){var objectLocation='me';var accessToken='';fieldToUpdate=(typeof fieldToUpdate=='undefined')?false:fieldToUpdate;useCookies=(typeof useCookies=='undefined')?true:useCookies;if(fbObject.dictionary.authenticatedUser.userId&&fbObject.dictionary.authenticatedUser.accessToken){objectLocation=fbObject.dictionary.authenticatedUser.userId;accessToken=fbObject.dictionary.authenticatedUser.accessToken;}
try{FB.api('/'+objectLocation,{'access_token':accessToken},function(response){var fbUserData={};fbUserData['name']=response.name;fbUserData['id']=response.id;if(response.email){if(response.email.indexOf('proxymail')==-1){fbUserData['email']=response.email;}else{fbUserData['email']='';}}
var accountLink='',nickNameSuggestion='';if(response.link){fbUserData['link']=response.link;nickNameSuggestion=response.link;if(nickNameSuggestion.indexOf('profile.php')==-1){nickNameSuggestion=nickNameSuggestion.replace('http://www.facebook.com/','');nickNameSuggestion=nickNameSuggestion.replace('https://www.facebook.com/','');nickNameSuggestion=nickNameSuggestion.replace(/\./g,'-');}else{nickNameSuggestion='';}}
var accountEmail='',formEmail=''
if(response.email){accountEmail=response.email;if(response.email.indexOf('proxymail')==-1){formEmail=response.email;}}
fbUserData['photo']="http://graph.facebook.com/"+response.id+"/picture";var userProfile={"accountID":fbUserData['id'],"accountPhoto":fbUserData['photo'],"accountName":fbUserData['name'],"accountLink":fbUserData['link'],"accountEmail":fbUserData['email'],"formEmail":formEmail,"formNameSuggestion":nickNameSuggestion};fbObject.dictionary.user.profile=userProfile;var maskedUserData=SM.util.base64_encode(JSON.stringify(userProfile));fbObject.dictionary.user.profile.masked=maskedUserData;if(useCookies){SM.util.setCookie("fbUserData",maskedUserData,365);}
if(typeof(trueValueFunc)==='function')trueValueFunc(userProfile,maskedUserData,response);});}
catch(err){alert('I\'m sorry, there was an error: . '+err);}}else{alert(fbObject._messages.cantCreateObject);}},getSMAccountStatus:function(returnValueFunc,fbUserID,serviceID,fbSessionKey){if(fbObject._state.fbResponse){fbUserID=(typeof(fbUserID)==='undefined')?fbObject.dictionary.user.userID:fbUserID;serviceID=(typeof(serviceID)==='undefined')?fbObject._settings.serviceID:serviceID;fbSessionKey=(typeof(fbSessionKey)==='undefined')?fbObject.dictionary.user.accessToken:fbSessionKey;}
autoLogin=(typeof(autoLogin)==='undefined')?fbObject._settings.smAutoLogin:autoLogin;var postData="socialID="+fbUserID+"&serviceID="+serviceID+"&sessionKey="+fbSessionKey+"&method=getAccountType";var handleSuccess=function(o){if(o.responseText!==undefined){fbObject._cache.smAccountStatus=o;var rpcResponse=YAHOO.lang.JSON.parse(o.responseText);if((rpcResponse.ServiceType=='1'||rpcResponse.ServiceType=='2')&&(rpcResponse.ValidUser)){fbObject.dictionary.smAccount.hasAccount=true;fbObject.dictionary.smAccount.canLogin=true;}else if((rpcResponse.ServiceType=='1'||rpcResponse.ServiceType=='2')&&(!rpcResponse.ValidUser)){fbObject.dictionary.smAccount.hasAccount=true;fbObject.dictionary.smAccount.canLink=true;fbObject.dictionary.smAccount.canLogin=false;}else{fbObject.dictionary.smAccount.hasAccount=false;fbObject.dictionary.smAccount.canLink=true;fbObject.dictionary.smAccount.canLogin=true;}
if(typeof(returnValueFunc)==='function')returnValueFunc(fbObject.dictionary.smAccount);}else{return false;}}
var handleFailure=function(o){alert('Could not retrieve account status');}
var callback={success:handleSuccess,failure:handleFailure,cache:false};if(fbObject._cache.smAccountStatus){handleSuccess(fbObject._cache.smAccountStatus);}else{if(fbObject._state.activeSession){var request=YAHOO.util.Connect.asyncRequest('POST','/rpc/social/',callback,postData);}else{}}
if(typeof(almostDoneFunct)==='function')almostDoneFunct(fbObject._state.activeSession,fbObject._state.hasPermissions,fbObject._state.hasAccount);},smLogin:function(serviceID){var currQuery=location.search.substring(1).toString();if(currQuery.indexOf("serviceID")>1){socialPanels.close();fbObject._state.canLink=false;fbObject._state.canLogin=false;if(typeof(fbObject._events.smLoginNotValid)==='function')fbObject._events.smLoginNotValid();return false;}
var currQuery=location.search.substring(1).toString();serviceID=(typeof(serviceID)==='undefined')?fbObject._settings.serviceID:serviceID;var newQuery=(currQuery?"&":"?")+'socialLogin=valid&serviceID='+serviceID;location.href=window.location.href.split('#')[0]+newQuery;},renderForm:function(elementId,preFillForm,trueValueFunc){preFillForm=(typeof preFillForm=='undefined')?false:preFillForm;elementId=(typeof elementId=='undefined')?fbObject._loginForm.elementId:elementId;if(preFillForm){if(!fbObject.dictionary.user.profile.masked)alert('We dont have enough data to prefill the form');var formData={socialID:fbObject.dictionary.user.userID,sessionData:fbObject.dictionary.user.userID,profileData:fbObject.dictionary.user.profile.masked};}else{var formData={socialID:'0',sessionData:'0',profileData:'0'};}
YE.onAvailable(elementId,function(){var formHTML='<input type="hidden" name="socialID" id="socialID" value="{socialID}" />';formHTML+='<input type="hidden" name="serviceID" id="serviceID" value="'+fbObject._settings.serviceID+'" />';formHTML+='<input type="hidden" name="sessionData" id="sessionData" value="{sessionData}" />';formHTML+='<input type="hidden" name="profileData" id="profileData" value="{profileData}" />';formHTML=fbObject.parseTemplate(formData,formHTML);YD.get(elementId).innerHTML=formHTML;if(typeof(trueValueFunc)==='function')trueValueFunc();});},populateForm:function(response,trueValueFunc){if(fbObject._state.userData&&fbObject._state.safeUserData){YD.get('socialID').value=fbObject._state.fbResponse.authResponse.userID;YD.get('serviceID').value=fbObject._state.fbResponse.authResponse.userID;YD.get('sessionData').value=fbObject._state.fbResponse.authResponse.userID;YD.get('profileData').value=fbObject._state.safeFBUserData;if(typeof(trueValueFunc)==='function')trueValueFunc();}else{}},renderButton:function(elementId,config){config=(fbObject.isUndefined(config))?{}:config;elementId=(fbObject.isUndefined(elementId))?fbObject._facebookButton.elementId:elementId;fbObject._facebookButton.elementId=elementId;customHTML=(typeof config.customHTML=='undefined')?false:config.customHTML;returnData=(typeof config.returnData=='undefined')?false:true;var styleTag;buttonData={id:fbObject._facebookButton.facebookButtonID,onclick:fbObject._facebookButton.onClick+'();return false;',src:fbObject._facebookButton.imgSrc,style:styleTag}
if(customHTML){var buttonCode=customHTML;}else{var buttonCode='<a href="#" onclick="{onclick}"><img src="{src}" style="{style}'+fbObject._facebookButton.loginButtonCSS+'" id="{id}" /></a>';}
buttonCode=fbObject.parseTemplate(buttonData,buttonCode);if(typeof(buttonCode!='undefined'))fbObject._facebookButton.loginButton=buttonCode.replace(styleTag,'');;if(typeof(trueValueFunc)==='function')trueValueFunc(buttonCode);if(returnData){return buttonCode;}else{YE.onAvailable(elementId,function(){YD.get(elementId).innerHTML=buttonCode;});}},swapButton:function(showButton){if(showButton=='login'){if(fbObject.isUndefined(fbObject._facebookButton.loginButton)){buttonCode=fbObject.renderButton('',{returnData:true});}else{buttonCode=fbObject._facebookButton.loginButton;}}else{if(fbObject.isUndefined(fbObject._facebookButton.logoutButton)){buttonCode=fbObject.renderLogoutButton();}else{}}
YD.get(fbObject._facebookButton.elementId).innerHTML=buttonCode;},renderLogoutButton:function(){var buttonCode='<a href="#" onclick="fbObject.logoutUser();return false;" style=""><img src="'+fbObject._facebookButton.logoutImgSrc+'" width="132" height="22" border="0" style="'+fbObject._facebookButton.logoutButtonCSS+'"></a>';if(typeof(buttonCode!='undefined'))fbObject._facebookButton.logoutButton=buttonCode;return buttonCode},renderWelcomeMessage:function(elementId,customHTML,returnData,trueValueFunc){templateData=(typeof(customHTML)=='undefined')?fbObject._messages.welcomeMessage:customHTML;elementId=(typeof(elementId)=='undefined')?fbObject._welcomeMessage.elementId:elementId;returnData=(typeof(returnData)=='undefined')?false:true;var welcomeMsg=fbObject.parseUserData(templateData);if(typeof(welcomeMsg!='undefined'))fbObject._state.welcomeMessage=welcomeMsg;if(typeof(trueValueFunc)==='function')trueValueFunc(welcomeMsg);if(returnData){return welcomeMsg;}else{YE.onAvailable(elementId,function(){YD.get(elementId).innerHTML=welcomeMsg;fbObject._state.welcomeMessageRendered=fbObject._welcomeMessage.renderImmediately;});}},hideIt:function(elementId,opacity){if(typeof(elementId!='undefined')){elementId=YD.get(elementId);elementId.style.display='none';if(typeof(opacity)!='undefined'){elementId.style.opacity=opacity;}}},showIt:function(elementId,opacity){if(typeof(elementId!='undefined')){elementId=YD.get(elementId);if(typeof(opacity)!='undefined'){elementId.style.opacity=opacity;}
elementId.style.display='';}},parseUserData:function(t){t=fbObject.parseTemplate(fbObject.dictionary.user.profile,t);t=fbObject.parseTemplate({logoutLink:'fbObject._events.logoutUser();return false;'},t);return t;},parseTemplate:function(d,t){for(var j in d){t=t.split("{"+j+"}").join(d[j])}
return t;},_elementExists:function(theEl){if(document.getElementById(theEl)!==null){return true;}else{return false;}},_forceVisibility:function(theEl){if(theEl==fbObject._facebookButton.facebookButtonID){fbObject._state.buttonRendered=true;fbObject._state.buttonHidden=false;}
YE.onAvailable(theEl,function(){theEl=YD.get(theEl);theEl.style.display='';theEl.style.visibility='visible';});},fadeIn:function(element,onCompleteFunc,msg,start,end,duration){msg=(typeof(msg)=='undefined')?false:msg;start=(typeof(start)=='undefined')?0:start;end=(typeof(end)=='undefined')?1:end;duration=(typeof(duration)=='undefined')?'.40':duration;var e;var easing=YAHOO.util.Easing.easeOut;if(start<end){fbObject._forceVisibility(element);}
element=YD.get(element);if(msg){msg=fbObject.parseUserData(msg);element.innerHTML=msg;}
fbObject.fade=new YAHOO.util.Anim(element,{opacity:{from:start,to:end}},duration,easing);fbObject.fade.animate();if(typeof(onCompleteFunc)==='function'){fbObject.fade.onComplete.subscribe(function(e){onCompleteFunc(e);});}
if(end<start&&end=='0'){}},fadeOut:function(element,onCompleteFunc,msg,start,end,duration){start=(typeof(start)=='undefined')?1:start;end=(typeof(end)=='undefined')?0:end;duration=(typeof(duration)=='undefined')?'.40':duration;fbObject.fadeIn(element,onCompleteFunc,msg,start,end,duration)},renderLoginPopup:function(){socialPanels.init({fixedcenter:true});socialPanels.renderTemplate('loading','Authenticating you with Facebook');setTimeout(function(){fbObject.smAutoLogin();},1600);},isUndefined:function(x){if(typeof(x)=='string'&&x.length==0){return true;}
if(typeof(x)=='undefined'){return true;}
if(x==null){return true;}
var isBlank=x==null&&x!==null;return isBlank;}};